<div id="l-map">
</div>

<div id="r-result">

  <input type="button" value="获得数据" onclick="getData()"/>
  <div id="result"></div>

</div>

<script type="text/javascript">

  // 百度地图API功能
  var map = new BMap.Map("l-map");
  map.centerAndZoom(new BMap.Point(116.404, 40.095), 11);
  map.enableScrollWheelZoom(true);
  var index = 0;
  var myGeo = new BMap.Geocoder();

  function geocodeSearch(add, index) {
    myGeo.getPoint(add, function (point) {
      if (point) {
        var address = new BMap.Point(point.lng, point.lat);
        addMarker(address, new BMap.Label(index + ":" + add, {offset: new BMap.Size(20, -10)}));
      }
    }, "北京市");
  }

  // 编写自定义函数,创建标注
  function addMarker(point, label) {
    var marker = new BMap.Marker(point);
    map.addOverlay(marker);
    marker.setLabel(label);
  }


  //  var local = new BMap.LocalSearch(map, {
  //    renderOptions:{map: map, panel:"r-result"},
  //    pageCapacity:5
  //  });
  //
  //  local.searchInBounds(myKeys, map.getBounds());
  //

  function getData() {
    $.ajax({
      type: "GET",
      url: "/ajax",
      dataType: 'json',
      success: function (data) {

//        var adds = [];
        $.each(data, function (index, element) {
//          adds.push(element.location);

          geocodeSearch(element.community, index);
        });

      },
      error: function () {
        alert('error')
      },
      timeout: function () {
        alert('time out')
      }
    })
  }


</script>

<style type="text/css">

  #l-map {
    height: 500px;
    width: 100%;
  }

  #r-result {
    width: 100%;
    font-size: 14px;
    line-height: 20px;
  }
</style>
