<br>
<div class="container-fluid">
  <div class="row">

    <div class="col-sm-3">
      <div id="r-result"></div>
    </div>

    <div class="col-sm-9">
      <div class="well">
        <div class="row">
          <button class="btn btn-primary btn-xs" style="margin-left: 60px" onclick="getData()"> 获取数据</button>
          <button class="btn btn-warning btn-xs" onclick="getMarket()"> 数据转换</button>
          <button class="btn btn-danger btn-xs" onclick="draw()"> 聚类图</button>
          <button class="btn btn-success btn-xs" onclick="searchLocalBus()"> 搜索公交车站</button>
          <button class="btn btn-success btn-xs" onclick="searchLocalShopping()"> 搜索商场</button>
          <button class="btn btn-success btn-xs" onclick="searchLocalSubway()"> 搜索地铁</button>
          <button class="btn btn-success btn-xs" onclick="searchLocalSchool()"> 搜索学校</button>
          <button class="btn btn-success btn-xs" onclick="searchLocalHospital()"> 搜索医院</button>
        </div>

      </div>

      <div id="l-map" style="height: 500px;width: 100%">
      </div>
    </div>

  </div>
</div>

<script type="text/javascript">

  //   百度地图API功能
  var map = new BMap.Map("l-map");
  map.centerAndZoom(new BMap.Point(116.404, 39.915), 12);
  map.enableScrollWheelZoom(true);
  var myGeo = new BMap.Geocoder();
  var adds = [];
  //  var markers =[] ;
  var house_location;
  var bus_info = [];
  var subway_info = [];
  var hospital_info = [];
  var school_info = [];
  var shopping_info = [];

  function getMarket() {
    $.each(adds, function (index, element) {
      myGeo.getPoint(element, function (point) {
        if (point) {
          var address = new BMap.Point(point.lng, point.lat);
          addMarker(address, new BMap.Label(index + ":" + element, {offset: new BMap.Size(20, -10)}));
//          markers.push(new BMap.Marker(address));
          house_location = address;
        }
      }, "北京市");
    });
  }

  function searchLocalBus() {
    map.centerAndZoom(house_location, 15);
    map.clearOverlays();
    var circle = new BMap.Circle(house_location, 1500, {
      fillColor: "blue",
      strokeWeight: 1,
      fillOpacity: 0.1,
      strokeOpacity: 0.3
    });

    map.addOverlay(circle);

    var local_bus = new BMap.LocalSearch(map, {
      renderOptions: {map: map, panel: "r-result", autoViewport: false},
      pageCapacity: 5,
      onSearchComplete: function (results) {
        // 判断状态是否正确
        if (local_bus.getStatus() == BMAP_STATUS_SUCCESS) {

          for (var i = 0; i < results.getCurrentNumPois(); i++) {

            var locate = results.getPoi(i);
            var distance = map.getDistance(locate.point, house_location).toFixed(2);

            //定义折线
            var polyline = new BMap.Polyline([locate.point, house_location], {
              strokeColor: "blue",
              strokeWeight: 4,
              strokeOpacity: 0.5
            });
            map.addOverlay(polyline);
            bus_info.push("{" + locate.title + "," + locate.point.lng + ',' + locate.point.lat + ',' + distance + '}');
          }
          document.getElementById("r-result").innerHTML = bus_info.join("<br/>");
        }
      }
    });
    local_bus.searchNearby('公交站', house_location, 1500);
  }


  function searchLocalHospital() {
    map.centerAndZoom(house_location, 15);
    map.clearOverlays();
    var circle = new BMap.Circle(house_location, 1500, {
      fillColor: "blue",
      strokeWeight: 1,
      fillOpacity: 0.1,
      strokeOpacity: 0.3
    });
    map.addOverlay(circle);
    var local_hospital = new BMap.LocalSearch(map, {
      renderOptions: {map: map, panel: "r-result", autoViewport: false},
      pageCapacity: 5,
      onSearchComplete: function (results) {
        if (local_hospital.getStatus() == BMAP_STATUS_SUCCESS) {
          for (var i = 0; i < results.getCurrentNumPois(); i++) {
            var locate = results.getPoi(i);
            var distance = map.getDistance(locate.point, house_location).toFixed(2);
            var polyline = new BMap.Polyline([locate.point, house_location], {
              strokeColor: "blue",
              strokeWeight: 4,
              strokeOpacity: 0.5
            });
            map.addOverlay(polyline);
            hospital_info.push("{" + locate.title + "," + locate.point.lng + ',' + locate.point.lat + ',' + distance + '}');
          }
          document.getElementById("r-result").innerHTML = hospital_info.join("<br/>");
        }
      }
    });
    local_hospital.searchNearby('医院', house_location, 1500);
  }


  function searchLocalSubway() {
    map.centerAndZoom(house_location, 15);
    map.clearOverlays();
    var circle = new BMap.Circle(house_location, 1500, {
      fillColor: "blue",
      strokeWeight: 1,
      fillOpacity: 0.1,
      strokeOpacity: 0.3
    });
    map.addOverlay(circle);
    var local_subway = new BMap.LocalSearch(map, {
      renderOptions: {map: map, panel: "r-result", autoViewport: false},
      pageCapacity: 5,
      onSearchComplete: function (results) {
        if (local_subway.getStatus() == BMAP_STATUS_SUCCESS) {
          for (var i = 0; i < results.getCurrentNumPois(); i++) {
            var locate = results.getPoi(i);
            var distance = map.getDistance(locate.point, house_location).toFixed(2);
            var polyline = new BMap.Polyline([locate.point, house_location], {
              strokeColor: "blue",
              strokeWeight: 4,
              strokeOpacity: 0.5
            });
            map.addOverlay(polyline);
            subway_info.push("{" + locate.title + "," + locate.point.lng + ',' + locate.point.lat + ',' + distance + '}');
          }
          document.getElementById("r-result").innerHTML = subway_info.join("<br/>");
        }
      }
    });
    local_subway.searchNearby('地铁', house_location, 1500);
  }


  function searchLocalSchool() {
    map.centerAndZoom(house_location, 15);
    map.clearOverlays();
    var circle = new BMap.Circle(house_location, 1500, {
      fillColor: "blue",
      strokeWeight: 1,
      fillOpacity: 0.1,
      strokeOpacity: 0.3
    });
    map.addOverlay(circle);
    var local_school = new BMap.LocalSearch(map, {
      renderOptions: {map: map, panel: "r-result", autoViewport: false},
      pageCapacity: 5,
      onSearchComplete: function (results) {
        if (local_school.getStatus() == BMAP_STATUS_SUCCESS) {
          for (var i = 0; i < results.getCurrentNumPois(); i++) {
            var locate = results.getPoi(i);
            var distance = map.getDistance(locate.point, house_location).toFixed(2);
            var polyline = new BMap.Polyline([locate.point, house_location], {
              strokeColor: "blue",
              strokeWeight: 4,
              strokeOpacity: 0.5
            });
            map.addOverlay(polyline);
            school_info.push("{" + locate.title + "," + locate.point.lng + ',' + locate.point.lat + ',' + distance + '}');
          }
          document.getElementById("r-result").innerHTML = school_info.join("<br/>");
        }
      }
    });
    local_school.searchNearby('学校', house_location, 1500);
  }


  function searchLocalShopping() {
    map.centerAndZoom(house_location, 15);
    map.clearOverlays();
    var circle = new BMap.Circle(house_location, 1500, {
      fillColor: "blue",
      strokeWeight: 1,
      fillOpacity: 0.1,
      strokeOpacity: 0.3
    });
    map.addOverlay(circle);
    var local_shopping = new BMap.LocalSearch(map, {
      renderOptions: {map: map, panel: "r-result", autoViewport: false},
      pageCapacity: 5,
      onSearchComplete: function (results) {
        if (local_shopping.getStatus() == BMAP_STATUS_SUCCESS) {
          for (var i = 0; i < results.getCurrentNumPois(); i++) {
            var locate = results.getPoi(i);
            var distance = map.getDistance(locate.point, house_location).toFixed(2);
            var polyline = new BMap.Polyline([locate.point, house_location], {
              strokeColor: "blue",
              strokeWeight: 4,
              strokeOpacity: 0.5
            });
            map.addOverlay(polyline);
            shopping_info.push("{" + locate.title + "," + locate.point.lng + ',' + locate.point.lat + ',' + distance + '}');
          }
          document.getElementById("r-result").innerHTML = shopping_info.join("<br/>");
        }
      }
    });
    local_shopping.searchNearby("超市 商店", house_location, 1500);
  }


  function draw() {
    var markerClusterer = new BMapLib.MarkerClusterer(map, {markers: markers});
  }

  function addMarker(point, label) {
    var marker = new BMap.Marker(point);
    map.addOverlay(marker);
    marker.setLabel(label);
  }

  function getData() {
    $.ajax({
      type: "GET",
      url: "/ajax",
      dataType: 'json',
      success: function (data) {

        $.each(data, function (index, element) {
          adds.push(element.community);
        });

      },
      error: function () {
        alert('error')
      },
      timeout: function () {
        alert('time out')
      }
    })
  }


</script>

